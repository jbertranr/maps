<!DOCTYPE html>
<html>
    <head>
        <title>jQM Complex Demo</title>
        <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
        <!--meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no; target-densityDpi=device-dpi"/-->
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
        <link rel="stylesheet" href="http://leafletjs.com/dist/leaflet.css" />
		<style>
		
			#map { 
				margin:-15px;
				height: 100%;
				width:100%; 
			}
		</style>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
        <script type="text/javascript" src="http://leafletjs.com/dist/leaflet.js"></script>
		<script type="text/javascript">		
		var visor = {
			map : {}, // 	Objecte OpenLayers del mapa
			greenIcon : {}
		}
		
		function callback(data) {
			for (var i = 1; i < data.length ; i++) {			 
			  L.marker([data[i][3], data[i][2]],{icon:visor.greenIcon}).addTo(visor.map)
				.bindPopup(data[i][1]);
			}
			visor.map.setView([data[2][3], data[2][2]], 7);
					
		}			
		
		function ajustaFinestres(){
			$('#map').width($(window).width());
			$('#map').height($(window).height() - $('#header').height() - $('#footer').height() - 95);		 
		 }
		 
		 function mapaFisic(){
		 	var Esri_WorldPhysical = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
				attribution: 'Tiles &copy; Esri &mdash; Source: US National Park Service',
				maxZoom: 8
			});
			Esri_WorldPhysical.addTo(visor.map);
		 }
		 
		
		$(document).on('pageinit', '#index', function(){ 		
		  // The web service URL from Drive 'Deploy as web app' dialog.
				
			visor.map = L.map('map');
			
			visor.greenIcon = L.icon({
				iconUrl: 'http://leafletjs.com/docs/images/leaf-green.png',
				shadowUrl: 'http://leafletjs.com/docs/images/leaf-shadow.png',
				iconSize:     [19, 47], // size of the icon
				shadowSize:   [25, 32], // size of the shadow
				iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
				shadowAnchor: [4, 62],  // the same for the shadow
				popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
			});
			
			
     		var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
			});
			
			var Esri_WorldPhysical = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
				attribution: 'Tiles &copy; Esri &mdash; Source: US National Park Service',
				maxZoom: 8
			});
			
			Esri_WorldPhysical.addTo(visor.map);
			osm.addTo(visor.map);
			

			var baseMaps = {"Grayscale": osm};
			//var overlayMaps = { "Cities": cities };	
			L.control.layers(baseMaps).addTo(visor.map);
			
			var DATA_SERVICE_URL = "http://script.google.com/macros/s/AKfycbyrBqVPxk392h-dKMSe7ScINdcT7aAxJr-9lCH22VU/exec?jsonp=callback";
			var scriptElement = document.createElement('script');
			scriptElement.src = DATA_SERVICE_URL;
			document.getElementsByTagName('head')[0].appendChild(scriptElement);
			ajustaFinestres();
	
		
			// add an OpenStreetMap tile layer
			// add a marker in the given location, attach some popup content to it and open the popup
			/*
				L.marker([51.5, -0.09]).addTo(map)
				.bindPopup('A pretty CSS3 popup. <br> Easily customizable.')
				.openPopup();
			*/	

		});

/*		function onLocationFound(e) {			
			var radius = e.accuracy / 2;			
			L.marker(e.latlng).addTo(map)
			.bindPopup("You are within " + radius + " meters from this point").openPopup();			
			L.circle(e.latlng, radius).addTo(map);
		}

		function onLocationError(e) {
			L.map('map').setView([51.505, -0.09], 13);
		}
*/

		
	</script>
		
		
    </head>
    <body>
        <div data-role="page" id="index">
            <div data-theme="b" data-role="header" id = "header">
                <h1>Index page</h1>
            </div>            
            <div data-role="content">
                <div id="map"></div>
            </div>
			<div data-role="footer" data-theme="a" id = "footer" >
				<div data-role="controlgroup" data-type="horizontal">
				  <a onclick=" mapaFisic()"  href="#" data-role="button">Earth</a>
				  <a href="#" data-role="button">Satellite</a>
				  <a href="#" data-role="button">Back</a>
				</div>
			</div>			
        </div>    
    </body>
</html>
